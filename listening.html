<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlueBadge â€“ Luistervaardigheid</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="with-sidebar with-right">
  <header>
    <nav class="top-nav">
      <div class="nav-brand"><h1><a href="index.html" style="text-decoration:none; color:inherit;">ðŸš” BlueBadge</a></h1></div>
      <div class="nav-links">
        <a href="index.html" data-i18n="dashboard">Dashboard</a>
        <a href="quiz.html" data-i18n="daily_quiz">Dagelijkse Quiz</a>
        <a href="cognitief.html" data-i18n="cognitive_skills">Cognitieve Vaardigheden</a>
        <a href="taal.html" data-i18n="language_training">Taaltraining</a>
        <a href="voortgang.html" data-i18n="progress">Voortgang</a>
        <select id="language-select" aria-label="Language" style="margin-left: 8px;">
          <option value="nl">NL</option>
          <option value="fr">FR</option>
          <option value="en">EN</option>
          <option value="de">DE</option>
          <option value="tr">TR</option>
        </select>
      </div>
    </nav>
    <div class="hero-section">
      <h2>LISTENING</h2>
      <p data-i18n="listening">Luistervaardigheid</p>
    </div>
  </header>

  <main style="max-width:900px;margin:24px auto;">
    <section class="test-interface" id="ls-interface" style="display:block;">
      <h3 id="ls-title">Luistervaardigheid â€“ 10 Soru</h3>
      <div class="test-container">
        <div class="test-header">
          <div class="test-info">
            <span id="ls-counter">Soru 1/10</span>
            <span id="ls-timer">00:00</span>
          </div>
          <div class="test-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="ls-progress" style="width: 10%"></div>
            </div>
          </div>
        </div>
        <div class="question-container">
          <div id="ls-audio" class="audio-content">
            <button class="audio-btn" id="ls-play">ðŸ”Š Oynat</button>
            <p class="audio-note"><em>GerÃ§ek sÄ±navda ses dosyasÄ± olur; burada metin TTS ile okunur.</em></p>
          </div>
          <div class="question-text" id="ls-question">...</div>
          <div class="question-options" id="ls-options"></div>
        </div>
        <div class="test-controls">
          <button class="control-btn secondary" id="ls-prev" disabled>Vorige</button>
          <button class="control-btn primary" id="ls-next">Volgende</button>
          <button class="control-btn success" id="ls-end" style="display:none;">Einde</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>Â© 2025 BlueBadge | Classified Training System</p>
  </footer>

  <script src="i18n.js"></script>
  <script src="layout.js"></script>
  <script>
    let data = []; let qs = []; let idx=0; let answers=[]; let score=0; let start=null; let currentText='';

    async function load(){
      try { bbLoading?.show(); data = await fetchJSON('data/taal_luisteren.json', { validate: d=> Array.isArray(d) }); } catch { data = []; } finally { bbLoading?.hide(); }
      qs = shuffle(data).slice(0,10);
      answers = new Array(qs.length).fill(undefined);
      idx=0; score=0; start=new Date(); render();
    }
    function shuffle(a){ const s=[...a]; for(let i=s.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[s[i],s[j]]=[s[j],s[i]]} return s }
    function speak(text){ try{ const u = new SpeechSynthesisUtterance(text); u.lang='nl-NL'; u.rate=0.9; speechSynthesis.speak(u); }catch{}
    }
    function render(){
      const q = qs[idx]; if(!q) return;
      currentText = q.audioText || '';
      document.getElementById('ls-counter').textContent = `Soru ${idx+1}/${qs.length}`;
      document.getElementById('ls-progress').style.width = (((idx+1)/qs.length)*100)+'%';
      document.getElementById('ls-question').innerHTML = `<h4>${idx+1}</h4><p>${q.vraag}</p>`;
      const opts = document.getElementById('ls-options'); opts.innerHTML='';
      q.opties.forEach((o,i)=>{
        const b = document.createElement('button'); b.className='option-btn'; b.textContent=o;
        b.onclick=()=>{ answers[idx]=i; updateNav(); };
        if(answers[idx]===i) b.classList.add('selected');
        opts.appendChild(b);
      });
      updateNav();
    }
    function updateNav(){
      document.getElementById('ls-prev').disabled = idx===0;
      document.getElementById('ls-next').disabled = answers[idx]===undefined;
      const last = idx===qs.length-1; const show = last && answers[idx]!==undefined; document.getElementById('ls-end').style.display = show? 'block':'none';
    }
    function prev(){ if(idx>0){ idx--; render(); } }
    function next(){ if(idx < qs.length-1){ idx++; render(); } }
    function finish(){
      score = qs.reduce((s,q,i)=> s + (answers[i]===q.antwoord?1:0), 0);
      const perc = Math.round((score/qs.length)*100);
      const result = { date: new Date().toISOString().split('T')[0], time: new Date().toLocaleTimeString('nl-NL'), category: 'luisteren', score, total: qs.length, percentage: perc };
      let languageResults = JSON.parse(localStorage.getItem('languageResults')||'[]'); languageResults.unshift(result); languageResults = languageResults.slice(0,100); localStorage.setItem('languageResults', JSON.stringify(languageResults));
      localStorage.setItem('lastQuizResult', JSON.stringify({ type:'taal', category:'luisteren', score, total: qs.length, percentage: perc, questions: qs.map((q,i)=>({ vraag:q.vraag, opties:q.opties, userIndex: answers[i], correctIndex: q.antwoord })) }));
      location.href = 'resultaten.html';
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      load();
      document.getElementById('ls-play').addEventListener('click', ()=>speak(currentText));
      document.getElementById('ls-prev').addEventListener('click', prev);
      document.getElementById('ls-next').addEventListener('click', next);
      document.getElementById('ls-end').addEventListener('click', finish);
    });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlueBadge â€“ Mini-Case</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <nav class="top-nav">
      <div class="nav-brand"><h1><a href="index.html" style="text-decoration:none; color:inherit;">ðŸš” BlueBadge</a></h1></div>
      <div class="nav-links">
        <a href="index.html">Dashboard</a>
        <a href="simulation.html">Simulatie</a>
      </div>
    </nav>
    <div class="hero-section"><h2>MINI-CASE</h2><p>Senaryo tabanlÄ± karar verme</p></div>
  </header>
  <main style="max-width:900px;margin:24px auto;">
    <section class="test-interface" style="display:block;">
      <div class="test-container">
        <div class="test-header"><div class="test-info"><span id="case-title">...</span><span id="case-step" style="margin-left:auto;">1/1</span></div></div>
        <div class="question-container">
          <div class="question-text" id="case-context">...</div>
          <div class="question-text" id="case-question" style="margin-top:8px;">...</div>
          <div class="question-options" id="case-options"></div>
        </div>
        <div class="test-controls">
          <button class="control-btn secondary" id="case-prev" disabled>Vorige</button>
          <button class="control-btn primary" id="case-next" disabled>Volgende</button>
          <button class="control-btn success" id="case-end" style="display:none;">Einde</button>
        </div>
      </div>
    </section>
  </main>
  <footer>
    <p>Â© 2025 BlueBadge | Classified Training System</p>
  </footer>
  <script src="i18n.js"></script>
  <script>
    let cases = []; let current = null; let steps = []; let step = 0; let answers = []; let score=0;
    async function load(){
      try { const imp = JSON.parse(localStorage.getItem('import_cases')||'[]'); if(Array.isArray(imp)&&imp.length){ cases = imp; } } catch{}
      if (!cases.length){
        cases = [ { title:'Gece GÃ¼rÃ¼ltÃ¼', context:'03:00 sularÄ±nda apartmandan yÃ¼ksek ses ÅŸikayeti alÄ±ndÄ±.', steps:[
          { vraag:'Ä°lk adÄ±m ne olmalÄ±?', opties:['Hemen ceza yaz','Yerinde durum deÄŸerlendirmesi','ÅžikayetÃ§iyi azarla','Bekle'], best:1, uitleg:'Ã–nce yerinde durum deÄŸerlendirmesi yapÄ±lÄ±r.', tags:['prosedÃ¼r'] },
          { vraag:'ÅžikayetÃ§i ile iletiÅŸim nasÄ±l kurulmalÄ±?', opties:['Emredici','Sakin ve aÃ§Ä±klayÄ±cÄ±','AlaycÄ±','Kaba'], best:1, uitleg:'Sakin ve aÃ§Ä±klayÄ±cÄ± iletiÅŸim kurmak gerekir.', tags:['iletiÅŸim'] }
        ] } ];
      }
      try{ const idx = parseInt(localStorage.getItem('import_cases_active_idx')||'0'); current = cases[Math.max(0, Math.min(cases.length-1, idx))] || cases[0]; } catch{ current = cases[0]; }
      steps = Array.isArray(current.steps) && current.steps.length ? current.steps : [{ vraag: current.vraag, opties: current.opties, best: current.best, uitleg: current.uitleg, tags: current.tags||[] }];
      step=0; answers=new Array(steps.length).fill(undefined); score=0; render();
    }
    function render(){
      document.getElementById('case-title').textContent = current.title || 'Mini-Case';
      document.getElementById('case-step').textContent = `${step+1}/${steps.length}`;
      document.getElementById('case-context').textContent = current.context || '';
      const cur = steps[step] || {};
      document.getElementById('case-question').textContent = cur.vraag || '...';
      const opts = document.getElementById('case-options'); opts.innerHTML='';
      (cur.opties||[]).forEach((o,i)=>{ const b=document.createElement('button'); b.className='option-btn'; b.textContent=o; b.onclick=()=>{ answers[step]=i; updateNav(); }; if(answers[step]===i) b.classList.add('selected'); opts.appendChild(b); });
      updateNav();
    }
    function updateNav(){
      document.getElementById('case-prev').disabled = step===0;
      const answered = answers[step]!==undefined; document.getElementById('case-next').disabled = !answered || step===steps.length-1;
      const onLast = step===steps.length-1;
      document.getElementById('case-end').style.display = onLast && answered? 'block':'none';
    }
    function prev(){ if(step>0){ step--; render(); } }
    function next(){ if(step<steps.length-1){ step++; render(); } }
    function end(){
      score = 0; const results=[];
      steps.forEach((s,i)=>{ const u=answers[i]; const c = typeof s.best==='number'? s.best:0; const ok = u===c; if(ok) score++; results.push({ vraag:s.vraag, opties:s.opties, userIndex:u, correctIndex:c, uitleg:s.uitleg||'', tags: Array.isArray(s.tags)? s.tags: [] }); });
      const total = steps.length; const percentage = Math.round((score/total)*100);
      const result = { date: new Date().toISOString().split('T')[0], time:new Date().toLocaleTimeString('nl-NL'), category:'case', score, total, percentage, type:'case' };
      const list = JSON.parse(localStorage.getItem('quizResults')||'[]'); list.unshift(result); localStorage.setItem('quizResults', JSON.stringify(list.slice(0,100)));
      localStorage.setItem('lastQuizResult', JSON.stringify({ type:'case', score, total, percentage, questions: results }));
      location.href='resultaten.html';
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      load();
      document.getElementById('case-prev').addEventListener('click', prev);
      document.getElementById('case-next').addEventListener('click', next);
      document.getElementById('case-end').addEventListener('click', end);
    });
  </script>
</body>
</html>
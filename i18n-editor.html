<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlueBadge â€“ i18n Editor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <nav class="top-nav">
      <div class="nav-brand"><h1><a href="index.html" style="text-decoration:none; color:inherit;">ðŸš” BlueBadge</a></h1></div>
      <div class="nav-links">
        <a href="index.html">Dashboard</a>
      </div>
    </nav>
    <div class="hero-section"><h2>i18n Editor</h2><p>Ã‡eviri anahtarlarÄ±nÄ± dÃ¼zenle ve indir</p></div>
  </header>
  <main style="max-width:1000px;margin:24px auto;">
    <div style="display:flex; gap:16px;">
      <textarea id="i18n-raw" style="flex:1; min-height:400px; background:#0f172a; color:#e2e8f0; border:1px solid #334; border-radius:8px; padding:12px;"></textarea>
      <div style="width:280px; display:flex; flex-direction:column; gap:8px;">
        <button class="challenge-btn" id="load">YÃ¼kle</button>
        <button class="module-btn" id="apply">Uygula</button>
        <button class="challenge-btn" id="download">JSON indir</button>
        <button class="module-btn" id="validate">Eksik AnahtarlarÄ± Tara</button>
        <pre id="i18n-report" style="white-space:pre-wrap; background:#0b1220; color:#cbd5e1; padding:8px; border-radius:8px; max-height:240px; overflow:auto;"></pre>
      </div>
    </div>
  </main>
  <script>
    let data = {};
    async function fetchLang(){ const r = await fetch('data/languages.json'); data = await r.json(); document.getElementById('i18n-raw').value = JSON.stringify(data, null, 2); }
    function apply(){ try { data = JSON.parse(document.getElementById('i18n-raw').value); localStorage.setItem('i18n_override', JSON.stringify(data)); alert('UygulandÄ± (geÃ§ici).'); } catch(e){ alert('JSON hatasÄ±: '+e.message) } }
    function download(){ const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'languages.json'; a.click(); }
    function validate(){
      try{ data = JSON.parse(document.getElementById('i18n-raw').value); }catch(e){ return alert('JSON hatasÄ±'); }
      const langs = Object.keys(data||{});
      const keys = new Set();
      langs.forEach(l=>{ Object.keys(data[l]||{}).forEach(k=> keys.add(k)); });
      const missing = {};
      langs.forEach(l=>{ missing[l]=[]; keys.forEach(k=>{ if(!data[l]|| data[l][k]===undefined){ missing[l].push(k); } }); });
      const pages = ['index.html','quiz.html','cognitief.html','taal.html','voortgang.html','flashcards.html','simulation.html','wrongs.html','content-admin.html','analytics.html','cases.html','resultaten.html'];
      // page keys
      Promise.all(pages.map(p=> fetch(p).then(r=> r.text()).then(t=>({p,t})).catch(()=>({p, t:''})))).then(results=>{
        const used=new Set();
        results.forEach(({t})=>{
          (t.match(/data-(translate|i18n)="([^"]+)"/g)||[]).forEach(m=>{ const k=m.split('=')[1].replace(/"/g,''); used.add(k); });
        });
        const missingUsed = {};
        langs.forEach(l=>{ missingUsed[l]=[]; used.forEach(k=>{ if(!data[l]|| data[l][k]===undefined){ missingUsed[l].push(k); } }); });
        const report = [];
        report.push('Eksik anahtarlar:');
        langs.forEach(l=>{ if(missing[l].length) report.push(`- ${l}: ${missing[l].length}`); });
        report.push('\nSayfalarda kullanÄ±lan ama eksik olanlar:');
        langs.forEach(l=>{ if(missingUsed[l].length) report.push(`- ${l}: ${missingUsed[l].join(', ')}`); });
        document.getElementById('i18n-report').textContent = report.join('\n');
      });
    }
    document.getElementById('load').onclick = fetchLang;
    document.getElementById('apply').onclick = apply;
    document.getElementById('download').onclick = download;
    document.getElementById('validate').onclick = validate;
  </script>
</body>
</html>
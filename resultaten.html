<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlueBadge ‚Äì Resultaten</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="with-sidebar with-right">
  <header>
    <nav class="top-nav">
      <div class="nav-brand">
        <h1><a href="index.html" style="text-decoration:none; color:inherit;">üöî BlueBadge</a></h1>
      </div>
      <div class="nav-links">
        <a href="index.html" data-i18n="dashboard">Dashboard</a>
        <a href="quiz.html" data-i18n="daily_quiz">Dagelijkse Quiz</a>
        <a href="cognitief.html" data-i18n="cognitive_skills">Cognitieve Vaardigheden</a>
        <a href="taal.html" data-i18n="language_training">Taaltraining</a>
        <a href="voortgang.html" data-i18n="progress">Voortgang</a>
        <select id="language-select" aria-label="Language" style="margin-left: 8px;">
          <option value="nl">NL</option>
          <option value="fr">FR</option>
          <option value="en">EN</option>
          <option value="de">DE</option>
          <option value="tr">TR</option>
        </select>
        <div id="language-switcher"></div>
      </div>
    </nav>
    <div class="hero-section">
      <h2>RESULTATEN</h2>
      <p>Overzicht van je laatste test of quiz</p>
    </div>
  </header>

  <main>
    <section class="test-results" style="display:block;">
      <h3>üéØ Jouw Score</h3>
      <div class="results-container">
        <div class="score-display">
          <div class="main-score">
            <span class="score-number" id="res-score">0</span>
            <span class="score-total" id="res-total">/ 0</span>
          </div>
          <div class="percentage-score" id="res-percentage">0%</div>
          <div class="performance-rating" id="res-rating">Blijf oefenen!</div>
        </div>
        <div class="detailed-results">
          <div class="result-breakdown">
            <h4>Details</h4>
            <div id="res-details"></div>
            <div id="res-breakdown" style="margin-top:12px;"></div>
            <div id="res-tags-breakdown" style="margin-top:12px;"></div>
          </div>
        </div>
        <div class="result-actions">
          <button class="challenge-btn" onclick="window.history.back()">Terug</button>
          <button class="module-btn" onclick="location.href='index.html'">Dashboard</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 BlueBadge | Classified Training System</p>
    <p class="footer-note">Stay sharp. Stay ready. üîç</p>
  </footer>

  <script src="i18n.js"></script>
  <script src="auth.js"></script>
  <script src="layout.js"></script>
  <script>
    function sanitizeText(input){ if(typeof input !== 'string') return ''; return input.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[c])); }
    (function(){
      const data = JSON.parse(localStorage.getItem('lastQuizResult') || 'null');
      if (!data) return;
      const scoreEl = document.getElementById('res-score');
      const totalEl = document.getElementById('res-total');
      const percEl = document.getElementById('res-percentage');
      const ratingEl = document.getElementById('res-rating');
      const detailsEl = document.getElementById('res-details');

      scoreEl.textContent = data.score;
      totalEl.textContent = `/ ${data.total}`;
      percEl.textContent = `${data.percentage}%`;

      if (data.percentage >= 80) {
        ratingEl.textContent = 'Uitstekend!';
        ratingEl.className = 'performance-rating excellent';
      } else if (data.percentage >= 60) {
        ratingEl.textContent = 'Goed gedaan!';
        ratingEl.className = 'performance-rating good';
      } else {
        ratingEl.textContent = 'Blijf oefenen!';
        ratingEl.className = 'performance-rating needs-improvement';
      }

      if (Array.isArray(data.questions)) {
        detailsEl.innerHTML = data.questions.map((q, i) => {
          const vraag = sanitizeText(String(q.vraag || q.question || ''));
          const opties = Array.isArray(q.opties) ? q.opties.map(o=> sanitizeText(String(o))) : [];
          const userIdx = typeof q.userIndex === 'number' ? q.userIndex : null;
          const correctIdx = typeof q.correctIndex === 'number' ? q.correctIndex : null;
          const correct = q.correct === true || (userIdx !== null && correctIdx !== null && userIdx === correctIdx);
          return `
            <div style="text-align:left; margin-bottom:1rem; padding:0.75rem; border:1px solid rgba(0,0,0,0.1); border-radius:8px; background:#fff;">
              <div style="font-weight:700; color:${correct ? '#16a34a' : '#dc2626'}">${i+1}. ${vraag}</div>
              ${opties.length ? `<ul style='margin:0.5rem 0 0; padding-left:1.25rem;'>${optesList(opties, userIdx, correctIdx)}</ul>` : ''}
              ${Array.isArray(q.tags) && q.tags.length ? `<div style='margin-top:0.25rem; font-size:0.85rem; color:#6b7280;'>Etiketler: ${q.tags.join(', ')}</div>`: ''}
              ${typeof q.uitleg === 'string' && q.uitleg ? `<div style='margin-top:0.5rem; font-size:0.9rem; color:#374151;'>${sanitizeText(q.uitleg)}</div>` : ''}
            </div>
          `;
        }).join('');
      }

      // Category breakdown
      if (data.breakdown && typeof data.breakdown === 'object'){
        const bd = data.breakdown;
        const list = Object.entries(bd).map(([k,v])=>{
          return `<li style='display:flex; justify-content:space-between; gap:8px;'><span>${k}</span><span>${v.correct}/${v.total} (${v.percentage}%)</span></li>`;
        }).join('');
        document.getElementById('res-breakdown').innerHTML = `<h4 style='margin-top:12px;'>Per Kategori</h4><ul style='margin:6px 0 0 0; padding-left:1rem;'>${list}</ul>`;
      }

      // Tags breakdown
      if (data.tagsBreakdown && typeof data.tagsBreakdown === 'object'){
        const tb = data.tagsBreakdown;
        const list = Object.entries(tb).map(([k,v])=>{
          return `<li style='display:flex; justify-content:space-between; gap:8px;'><span>#${k}</span><span>${v.correct}/${v.total} (${v.percentage}%)</span></li>`;
        }).join('');
        document.getElementById('res-tags-breakdown').innerHTML = `<h4 style='margin-top:12px;'>Etiketler</h4><ul style='margin:6px 0 0 0; padding-left:1rem;'>${list}</ul>`;
      }

      function optesList(opties, userIdx, correctIdx){
        return opties.map((opt, idx) => {
          const isCorrect = (idx === correctIdx);
          const isUser = (idx === userIdx);
          const marker = isCorrect ? '‚úÖ' : (isUser ? '‚û§' : '‚Ä¢');
          const color = isCorrect ? '#16a34a' : (isUser ? '#1f2937' : '#111827');
          return `<li style='color:${color}'>${marker} ${opt}</li>`;
        }).join('');
      }
    })();
  </script>
</body>
</html>